# Proprietary Cohorts

## Introduction
Today, online advertising systems rely on 3rd party cookies to store the cross-publisher IDs that marketers use toidentify users across the web and group them into audience segments or cohorts using sophisticated algorithms based on their browsing behavior. Marketers use these cohorts to match advertising content to the users who are likely to be the most receptive. They are then able to record which users, and or cohorts, generated better marketer success metrics (e.g., visited the marketer website, purchased the marketer’s product) to determine how to adjust their budgeting and targeting of future content.

The ultimate goal of this system provides benefits for everyone involved. Users get to see more relevant ads, advertisers get to reach more responsive people and the measured effectiveness enables marketers to shift more budget to the publishers frequented by this audience, which in turn more effectively monetizes their content.

However, the use of individual user ids across page domains, made possible by 3rd party cookies comes at a high cost; it allows for uncomfortable sharing of a users’ browsing habits with marketers, and of marketer-defined user interests and potential buying habits with publishers.

This proposal attempts to provide a solution that will enable proprietary grouping of users into cohorts based on their browsing behavior in a way that addresses both marketer needs as well as the privacy and security concerns of sharing data with non-permissioned recipients.and prevents identifying individual users, doesn’t share their browsing behavior with advertisers and protects user interests and buying habits from being snooped by publishers. Equally important, this document looks to provide a workable alternative to encapsulating all decisioning in the browser (like Turtledove) or requiring a centralized, governing body to make decisions on what is or is not allowed (like Sparrow). If properly architected, the defined communications protocol between browser and “cohort provider” can achieve the twin goals of removing decision-making within centralized nodes (either browser or gatekeeper) and from the browser but also allowing an open, competitive marketplace of organizations to serve as a cohort provider. 

## API Example Flow
A website (news-publisher.example) who chooses to utilize proprietary cohorts can add a new html tag to the page header:

```
<link rel="cohort-register" href="https://cohort-provider.example/register">
```

Supporting browsers would read this tag and execute a request to  `cohort.example/register?cohortRegistrationId=12345&domain=news-publisher.example` where 12345 is a unique identifier generated by the browser included on all cohort registration requests across domains to this provider. The cohort provider would record this cohortRegistrationId and domain to build a proprietary graph of browserIds and behaviors and return a cohort ID to the browser.

```
{
    cohortID: a78d
}
```


The browser would store this cohortId for eligible users and make it available to the publisher via a JS API.

```
navigator.getCohortId();
```

Publishers could use this Cohort ID both for internal analytics purposes and forward it to marketers in ad requests. Marketers could use this Cohort ID to identify which cohorts are engaging most with their brand and could allocate more budget to publishers who attract users in this cohort to their properties.

This system would provide for the needed advertising functionality of both publishers and buyers while protecting users’ privacy.

## Design Elements

### Cohort Registration ID

The Cohort Registration ID is a value generated on the client (browser) and available only via the cohort registration. Calls to the same cohort provider across websites will include the same cohort registration id from a given client. Calls to different cohort providers will use different cohort registration IDs per cohort provider.

Clients will automatically reset cohort registration IDs periodically to enhance privacy (at least every 30 days from last cohort qualifying activity, but perhaps more frequentlyevery 8 days probably about right).

Users can manually reset cohort registration ids at any time.

### Registration Request

The cohort registration request will be initiated by the browser sometime after it encounters the cohort registration tag. The request will only include the cohort registration id and the website domain. No cookies, caching or other stateful mechanisms will be used in the request.

The browser may delay the registration call in order to prevent correlation with other page requests.

The browser may relay the registration request through a proxy to hide the IP address of the user.

The browser may ensure a minimum number of users have visited a given domain before initiating the registration request.

### Cohort IDs

A cohort ID indicates which cohort a user belongs to. In order to ensure these IDs are not used to identify a unique user, the number of valid cohort IDs can be limited to 100,000.

The browser can also ensure a cohort ID has a minimum number of users before allowing it access in the browser.

### Header Tag

The header tag is used to indicate a given publisher page is opting in to sharing page-load information with a cohort provider as well as indicating which cohort provider they are choosing to work with.

This opt-in / registration could also be done as a javascript API. Something like:

```
navigator.registerCohort("https://cohort-provider.example/register");
```

### Cohort Provider

The cohort provider can be any entity. It is responsible for grouping Cohort Registration IDs based on their browsing behavior and returning Cohort IDs to the browser.

Cohort providers never receive any requests including user identifiable information along with the cohort registration id to prevent any correlation between user identity and cohort registration ID.

## Benefits

* anyone can be a cohort provider because the browser controls what data is passed to the cohort provider and will not include any unique identifying info besides cohort registration id, which is never known outside of the request
* publishers and marketers can choose their own cohort providers

## Variants

* a single first party (domain or set) could send data to multiple providers, but can only receive a cohort from one. This will enable advertisers to provide info that can enable effective ads on publishers that might use different cohort providers but prevent the joining of cohort ids to a single first party id for fingerprinting purposes.
* websites can declare contextual data to be sent in the cohort request to enrich the available data for that page view. To prevent misuse (i.e. sending a first party user id) the contextual data will also be limited to 1000 unique ids per domain. Domains can publish a rubric to enrich these ids (i.e. map ‘1234’ to ‘political article’)
* contextual information could also be sent to the cohort provider as long as the risk for fingerprinting is low (think privacy budget). some options:
  * browser uses some aggregate page view service to ensure all reported urls have a minimum unique visitor count
  * publishers publish a list of valid urls once a day (that is limited to lets say 100). Browsers only include url in cohort registration if url is on the list. Browsers could proxy requests for this list with caching to eliminate the possibility of using a different list with different users (and use this to correlate users and history).

## Open Questions

* The following three questions assume that if marketers do not receive the capabilities to reduce “media waste” by having less effective content matching they will pay publishers less, which would thus reduce publisher revenues. Thus ensuring these are either addressed or the relative impact to publisher revenues is called out would be helpful (even if the impact would be less than proposed by other specifications). 
  * How do marketers and publishers analyze and understand what are the best activity-based rules to assign “eligible” people to cohorts? 
    * A cohort provider, rather than an individual marketer or publisher, determines the rule-sets that define eligibility. Thus, there would be some impact to marketer value and publisher revenue relative to alternate mechanisms.
How do marketers and publishers analyze and understand what is the unique unduplicated reach across different publishers for the same cohort? 
    * A cohort provider could identify unique reach (at least in terms of cohort registration ids) across publishers (perhaps publishing an estimated unique user count per cohort and/or per cohort-domain). This provides superior value relative to the proposed turtledove mechanism, which does not provide for calculations of unique reach.
  * How do marketers and publishers achieve cross-publisher frequency capping if the limit on the number of cohorts is less than the number of ads a user is exposed to?
    * Given the scale restrictions on cohorts, this proposal does not address cross-publisher frequency capping. Thus, there would be some impact to marketer value and publisher revenue relative to alternate mechanisms
